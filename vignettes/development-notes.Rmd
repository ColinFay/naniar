---
title: "Vignette Title"
author: "Vignette Author"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

These are various notes that I want to keep track off online

```{r}
library(simputation)
library(tidyverse)
library(naniar)
library(visdat)

# are there missings in the data?
anyNA(airquality)

# OK, where are these missings?
vis_miss(airquality)
miss_var_summary(airquality)

# OK, let's explore the missings in Solar.R and Ozone

da1 <- impute_lm(airquality, Solar.R ~ .)

as_tibble(airquality)
as_tibble(da1)

vis_miss(da1)

head(da1,3)

# How do people generally keep track of their imputations in the data?


mutate.nibble <- function(x){
  
  x <- mutate(x)
  # update the shadow index
  shadow_index <- which_na(x)
}

# using the special hidden form of Shadow df

ggplot(data = bind_shadow(airquality),
             aes(x = Temp)) + 
  geom_histogram() + 
  facet_wrap(~Ozone_NA,
             ncol = 1)

ggplot(data = bind_shadow(airquality),
             aes(x = Temp,
                 colour = Ozone_NA)) + 
  geom_density() 

ggplot(data = airquality,
       aes(x = Temp,
           colour = is.na(Ozone))) + 
  geom_density() 

# so you have:
# NA = Missing originally
# !NA = Not missing
# ?NA = Imputed
# However, this means that we can no longer store as TRUE/FALSE, but rather
# as a true factor, with defined kinds of missing values
# 

ggplot(data = airquality_nibble,
       aes(x = Temp,
           colour = Ozone)) + 
  geom_density() 

# imp + tibble = imple?
# imple object stores initial missings from when data was imputed.
# it would also update with the data as the data was changed
# so would require dplyr verbs with methods mutate.imple, etc.

# stat_impute would then take a imple object, and highlight/differentiate the
# missing values from ggplot

# Imputation in naniar ---------------------------------------------------------

# the `imputation()` or `na_impute` function.
# this would take a dataframe, and then some function for imputing values
# naniar "freezes" the dataframe input, and takes a record of the missing values
# and stores them as a sparse matrix (to save space)
# and then imputes the values.

# so, perhaps something like this:

# na_impute(.data = ,
#           .fun = )

# airquality_imp <- 
  # na_impute(.data = airquality,
  #           .fun = impute_cart(y ~ .))

# and provide a print method VERY similar to tibble
# but it would add braces around the missing values that were imputed
#>   # A {n}ibble: 153 × 6
#>   # <value> imputated values
#>     Ozone Solar.R  Wind  Temp Month   Day
#>     <int>   <int> <dbl> <int> <int> <int>
#> 1     41     190   7.4    67     5     1
#> 2     36     118   8.0    72     5     2
#> 3     12     149  12.6    74     5     3
#> 4     18     313  11.5    62     5     4
#> 5    {21}   {312}  14.3    56     5     5
#> 6     28    {109}  14.9    66     5     6
#> 7     23     299   8.6    65     5     7
#> 8     19      99  13.8    59     5     8
#> 9      8      19  20.1    61     5     9
#> 10    NA     194   8.6    69     5    10
#> # ... with 143 more rows
#> # ... with 

# What do we do when we want to plot these values and colour by imputation?

ggplot(airquality_imp,
       aes(x = Ozone,
           y = Solar.R,
           colour = .imputed)) + 
  geom_impute_point()

# if we would like to do this, we need to have a long form "behind the scenes"

#> 
#> # A {n}ibble: 918 × 3
#> # With <value> imputated values
#> rows      var   value .imputed
#> <int>    <chr> <lgl>    <dbl>
#>   1    1 Ozone   41     FALSE
#> 2      2 Ozone   36     FALSE
#> 3      3 Ozone   12     FALSE
#> 4      4 Ozone   18     FALSE
#> 5      5 Ozone  {21}    TRUE
#> 6      6 Ozone   28     FALSE
#> 7      7 Ozone   23     FALSE
#> 8      8 Ozone   19     FALSE
#> 9      9 Ozone    8     FALSE
#> 10    10 Ozone  NA      FALSE
#> # ... with 908 more rows
#> # ... and 

library(pryr)

index_na <- function(x) which(is.na(x), arr.ind = TRUE)

object_size(index_na(airquality))
```

